---
phase: 02-custom-cursor-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/CustomCursor/CustomCursor.tsx
  - src/app/layout.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Custom cursor (dot + follower ring) follows mouse smoothly with slight lag on desktop"
    - "Custom cursor is completely hidden on touch devices (phones, tablets)"
    - "Custom cursor respects prefers-reduced-motion (hidden or instant-follow when reduced motion active)"
    - "Custom cursor does not interfere with native click events, text selection, or keyboard navigation"
    - "Native browser cursor is hidden on desktop when custom cursor is visible"
    - "No console errors or memory leaks from cursor event listeners on route changes"
  artifacts:
    - path: "src/components/CustomCursor/CustomCursor.tsx"
      provides: "Custom cursor React component with GSAP quickTo mouse tracking"
      exports: ["CustomCursor"]
    - path: "src/app/layout.tsx"
      provides: "Root layout mounting CustomCursor at app level"
      contains: "CustomCursor"
    - path: "src/app/globals.css"
      provides: "Touch device hiding via CSS media query and native cursor hiding"
      contains: "@media (pointer: coarse)"
  key_links:
    - from: "src/components/CustomCursor/CustomCursor.tsx"
      to: "src/lib/gsap.ts"
      via: "imports gsap, MOTION_QUERIES"
      pattern: "import.*gsap.*MOTION_QUERIES.*from.*@/lib/gsap"
    - from: "src/app/layout.tsx"
      to: "src/components/CustomCursor/CustomCursor.tsx"
      via: "renders CustomCursor inside SmoothScrollProvider"
      pattern: "<CustomCursor"
---

<objective>
Create the core custom cursor component that replaces the default browser pointer with a smooth, GSAP-driven dual-element cursor (small dot + larger follower ring). The cursor tracks the mouse position using `gsap.quickTo()` for performant interpolation, is hidden on touch devices via CSS media queries, respects prefers-reduced-motion, and uses `pointer-events: none` to avoid interfering with any native interactions.

Purpose: Establishes the cursor as a visible design element (CURS-01), hidden on touch (CURS-04), non-interfering (CURS-05), accessible (reduced-motion), and mounted at the app root for site-wide availability.

Output: Working custom cursor that follows the mouse on desktop with a smooth lag effect, invisible on touch devices, respecting accessibility preferences.
</objective>

<execution_context>
@C:/Users/sammy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sammy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 1 infrastructure this plan builds on
@src/lib/gsap.ts
@src/hooks/useScrollAnimation.ts
@src/lib/providers/SmoothScrollProvider.tsx
@src/app/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CustomCursor component with GSAP quickTo mouse tracking, dual-element design, touch detection, and reduced-motion support</name>
  <files>src/components/CustomCursor/CustomCursor.tsx, src/app/globals.css</files>
  <action>
Create `src/components/CustomCursor/CustomCursor.tsx` as a `"use client"` component:

**Component structure:**
- Two elements: a small dot (8px, coral `#E2795E` fill) and a larger follower ring (32px, coral border, no fill). Both use `position: fixed`, `top: 0`, `left: 0`, `z-index: 9999` (dot) / `9998` (follower), `pointer-events: none`, and `translate: -50% -50%` for centering.
- Use `mix-blend-mode: difference` on the follower ring for automatic contrast adaptation across light/dark sections. The dot stays solid coral.
- Both elements get the CSS class `custom-cursor` for touch device hiding.

**Mouse tracking with GSAP quickTo:**
- Store refs for both elements (`cursorDotRef`, `cursorFollowerRef`).
- In a `useEffect`, create 4 `gsap.quickTo()` setters:
  - Dot: `duration: 0.15, ease: 'power2.out'` (fast, near-instant follow)
  - Follower: `duration: 0.5, ease: 'power2.out'` (slower, creates the "lag" effect per CURS-01 spec of 0.05-0.1s — the visual lag comes from the follower trailing behind the dot)
- Attach `mousemove` event listener on `window` to call all 4 quickTo setters with `e.clientX` and `e.clientY`.
- Return cleanup function removing the event listener.

**Reduced-motion support:**
- Use `gsap.matchMedia()` with `MOTION_QUERIES` from `@/lib/gsap`:
  - `noPreference` branch: enable cursor tracking (attach event listeners, set cursor visible)
  - `reduced` branch: hide both cursor elements (`gsap.set` to `display: 'none'`)
- Return `mm.revert()` in cleanup.

**Touch device detection (JavaScript fallback):**
- Early return `null` (render nothing) if `typeof window !== 'undefined'` and either `'ontouchstart' in window` or `navigator.maxTouchPoints > 0`. Use a `useState` + `useEffect` pattern to avoid SSR mismatch — default to not rendering, then check on mount.
- Primary touch hiding is CSS-based (see globals.css changes below), but this JS fallback catches edge cases.

**Initial state:**
- Both cursor elements start with `opacity: 0`. On the first `mousemove` event, set them to `opacity: 1` with a quick `gsap.to` (0.3s fade-in). This prevents the cursor appearing at (0,0) on page load.

**CSS changes to `src/app/globals.css`:**
Add at the end of the file:

```css
/* Custom cursor: hide on touch devices */
@media (pointer: coarse) and (hover: none) {
  .custom-cursor {
    display: none !important;
  }
}

/* Custom cursor: hide native cursor on desktop when custom cursor is active */
@media (pointer: fine) {
  html.cursor-active,
  html.cursor-active * {
    cursor: none !important;
  }
  /* Preserve text cursor for inputs/textareas */
  html.cursor-active input,
  html.cursor-active textarea,
  html.cursor-active select,
  html.cursor-active [contenteditable] {
    cursor: text !important;
  }
}
```

**In the component**, add the `cursor-active` class to `<html>` on mount (when not a touch device and not reduced-motion), remove it on unmount. This ensures native cursor hiding only happens when the custom cursor is actually rendering.

**Important implementation notes:**
- Do NOT use React state for cursor position — use refs + GSAP quickTo only (performance critical per research)
- Do NOT use `useGSAP` hook here — use plain `useEffect` because the cursor is not scope-bound to a container (it's fixed-position, page-level)
- Import gsap from `@/lib/gsap` (centralized config), NOT from 'gsap' directly
- The component should be lightweight — no context providers, no complex state
  </action>
  <verify>
- `npx tsc --noEmit` passes with zero TypeScript errors
- `npm run build` succeeds
- File exists at `src/components/CustomCursor/CustomCursor.tsx`
- File exports `CustomCursor` as named export
- File imports from `@/lib/gsap` (not from 'gsap')
- File contains `gsap.quickTo` calls
- File contains `pointer-events: none` on both cursor elements
- File contains `MOTION_QUERIES` usage
- `globals.css` contains `@media (pointer: coarse)` rule
- `globals.css` contains `.cursor-active` rule with `cursor: none`
  </verify>
  <done>
CustomCursor component created with dual-element design (dot + follower), GSAP quickTo mouse tracking with distinct speeds for dot (0.15s) and follower (0.5s), CSS + JS touch device hiding, reduced-motion support via GSAP matchMedia, pointer-events: none on all cursor elements, and opacity: 0 initial state with fade-in on first mousemove. Native cursor hiding CSS added to globals.css gated by pointer: fine media query and cursor-active HTML class.
  </done>
</task>

<task type="auto">
  <name>Task 2: Mount CustomCursor in root layout and verify complete cursor system</name>
  <files>src/app/layout.tsx</files>
  <action>
**Mount cursor in root layout (`src/app/layout.tsx`):**
- Import `CustomCursor` from `@/components/CustomCursor/CustomCursor`
- Add `<CustomCursor />` inside the `<SmoothScrollProvider>` block, BEFORE `{children}`. The cursor renders at the body level and is position: fixed, so placement order doesn't affect visual rendering — it just needs to be inside the provider hierarchy for consistent mounting.

Layout structure should be:
```tsx
<ThemeProvider>
  <SmoothScrollProvider>
    <CustomCursor />
    {children}
    <ScrollToTop />
    <ChatWidget />
  </SmoothScrollProvider>
</ThemeProvider>
```

**Verification steps:**
- Run `npm run build` to confirm zero errors
- Run `npm run dev` to confirm the dev server starts
- Verify in browser: cursor dot and follower ring visible on desktop, follow mouse with smooth lag
- Verify: clicking buttons, links, and text selection all work normally (pointer-events: none)
- Verify: no console errors related to GSAP, cursor, or hydration
  </action>
  <verify>
- `npm run build` succeeds with zero errors
- `src/app/layout.tsx` imports and renders `<CustomCursor />`
- `<CustomCursor />` is inside `<SmoothScrollProvider>` block
- Dev server starts without errors
  </verify>
  <done>
CustomCursor mounted in root layout inside SmoothScrollProvider. Build and dev server run without errors. Custom cursor is available site-wide on all pages.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. On desktop browser: two cursor elements visible (small coral dot + larger ring with blend mode) following mouse with smooth interpolation
3. Dot follows closely (0.15s), follower ring trails behind with visible lag (0.5s) — creates the "design element" feel
4. Clicking any button, link, or interactive element works normally — cursor doesn't intercept clicks
5. Text selection works normally in all text areas
6. Keyboard navigation (Tab, Enter, Space) works unchanged
7. On touch device (or Chrome DevTools device emulation with touch): no custom cursor visible
8. With `prefers-reduced-motion: reduce` enabled in Chrome DevTools > Rendering: custom cursor hidden
9. Navigate between 3+ pages: no console errors, no duplicate cursor instances, no memory leaks
10. Cursor appears with fade-in on first mouse movement (not stuck at top-left on load)
</verification>

<success_criteria>
- CURS-01 (partial): Cursor follows mouse with GSAP interpolation and slight lag (dual-element with 0.15s dot + 0.5s follower)
- CURS-04: Cursor hidden on touch devices via CSS media query + JS fallback
- CURS-05 (partial): pointer-events: none prevents click interference; keyboard nav unaffected
- Accessibility: Reduced-motion hides cursor; native cursor preserved for text inputs
- Performance: No React re-renders on mousemove (refs + quickTo only)
- Infrastructure: Cursor mounted at app root, available for Phase 02-02 hover state system
</success_criteria>

<output>
After completion, create `.planning/phases/02-custom-cursor-system/02-01-SUMMARY.md`
</output>
