---
phase: 06-portfolio-page-redesign
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/ui/TemplateCard.tsx
  - src/app/portfolio/page.tsx
autonomous: false

must_haves:
  truths:
    - "Portfolio uses masonry grid with mixed-size cards (popular templates span 2 columns on desktop)"
    - "Masonry grid is 3 columns on desktop, 2 on tablet, 1 on mobile"
    - "Project cards show muted autoplay video crossfading on hover (for templates with videoUrl)"
    - "Cards without video use subtle zoom/parallax on screenshot instead"
    - "Video pauses and resets to start on mouse leave"
    - "No video on mobile/touch — static screenshots only"
    - "Card default state shows screenshot, template name, category tag chip, price badge"
    - "Card hover state shows video (or zoom) + overlay with narrative tagline + View Details CTA"
    - "Category filter bar is horizontal pill buttons, sticky on scroll"
    - "Price breakdown panel removed from cards (View Details links to template detail page)"
    - "Custom cursor data-cursor='card' attribute on all portfolio cards"
  artifacts:
    - path: "src/components/ui/TemplateCard.tsx"
      provides: "Simplified PortfolioCard component with video hover"
      contains: "PortfolioCard"
    - path: "src/app/portfolio/page.tsx"
      provides: "Complete portfolio page with masonry grid, sticky filter, hero, CTA"
      contains: "grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
  key_links:
    - from: "src/components/ui/TemplateCard.tsx"
      to: "src/lib/templateData.ts"
      via: "imports TemplateData type and uses narrative, videoUrl fields"
      pattern: "import.*TemplateData.*from.*templateData"
    - from: "src/app/portfolio/page.tsx"
      to: "src/components/ui/TemplateCard.tsx"
      via: "imports and renders PortfolioCard in masonry grid"
      pattern: "import.*PortfolioCard.*from.*TemplateCard"
    - from: "src/app/portfolio/page.tsx"
      to: "src/lib/templateData.ts"
      via: "imports templates and categoryGroups for filtering"
      pattern: "import.*templates.*categoryGroups.*from.*templateData"
---

<objective>
Build the new PortfolioCard component with video-on-hover and assemble the complete masonry grid with sticky filter bar. Replace the over-engineered TemplateShowcaseCard with a single bold card and integrate everything into the portfolio page.

Purpose: The card component is the core visual element of this phase. The masonry grid, video hover, and sticky filter transform the page from a uniform grid to a dynamic, design-forward portfolio.
Output: New PortfolioCard component in TemplateCard.tsx. Complete portfolio page with masonry grid, sticky filters, and video hover. Human-verified result.
</objective>

<execution_context>
@C:/Users/sammy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sammy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-portfolio-page-redesign/06-01-SUMMARY.md
@src/lib/templateData.ts
@src/app/portfolio/page.tsx
@src/components/ui/TemplateCard.tsx
@src/components/ui/Container.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build PortfolioCard component with video hover</name>
  <files>src/components/ui/TemplateCard.tsx</files>
  <action>
Add a new `PortfolioCard` component to TemplateCard.tsx. Keep the existing TemplateShowcaseCard and TemplateGridCard exports intact (they may be used elsewhere).

**PortfolioCard component design:**

Props: `{ template: TemplateData; featured?: boolean }` — `featured` controls 2-col span styling externally.

**Touch detection:**
- Use a `useEffect` to detect touch devices via `'ontouchstart' in window || navigator.maxTouchPoints > 0` (matches CustomCursor.tsx pattern).
- Store in a `isMobile` state ref (useState, default false, set in useEffect).
- When isMobile is true, video elements are NOT rendered at all.

**Card structure (default/non-hover state):**
- Outer wrapper: `motion.div` with `data-cursor="card"` for custom cursor integration
- White card background with rounded-2xl, overflow-hidden, subtle shadow (shadow-md hover:shadow-xl)
- No accent bars, no tier badges, no category-colored backgrounds — simplified from TemplateShowcaseCard
- Screenshot thumbnail: aspect-[16/10], object-cover object-top, with loading="lazy"
- Below screenshot area:
  - Category tag chip: subtle pill with `bg-muted text-muted-foreground text-xs font-medium px-2.5 py-1 rounded-full` (NOT full category color tinting)
  - Template name: `text-lg font-bold text-primary` (link to `/templates/{id}`)
  - Price badge: `text-sm font-semibold text-accent` showing price (e.g. "$5,500")
- NO price breakdown panel (removed per user decision — "View Details" links to existing detail page)
- NO tech stack pills (moved to detail page)

**Hover state (desktop only):**
- Video crossfade: If template has `videoUrl` AND is not mobile:
  - Static thumbnail crossfades out (opacity transition 500ms)
  - Muted autoplay video crossfades in (opacity transition 500ms)
  - Video element: `<video ref={videoRef} muted loop playsInline preload="none">`
  - WebM source: `template.videoUrl`
  - MP4 fallback: `template.videoUrl.replace('.webm', '.mp4')`
  - On hover start: `videoRef.current.currentTime = 0; videoRef.current.play().catch(() => {})`
  - On hover end: `videoRef.current.pause(); videoRef.current.currentTime = 0`
- No video fallback: If template has NO videoUrl OR is mobile:
  - Subtle zoom on the screenshot image (scale 1.05, transition duration 700ms via CSS or Framer Motion animate)
- Dark overlay on hover: `bg-black/40` gradient overlay appears on the screenshot/video area
- Narrative tagline: Appears on hover inside the overlay — `text-white text-sm font-medium` showing `template.narrative`
- "View Details" CTA: Appears on hover — pill-shaped link to `/templates/{id}`, white/translucent `bg-white/15 backdrop-blur-md text-white`

**IntersectionObserver for lazy video loading:**
- Use a `useRef` + `useEffect` with IntersectionObserver (rootMargin: "100px", threshold: 0.1)
- Only render the `<video>` element when the card has entered the viewport (isInView state)
- When card scrolls out of view, pause the video
- This prevents loading 21 video files on page load

**Animation:**
- Card entrance: Use Framer Motion variants (opacity 0 -> 1, y 20 -> 0, duration 0.5, easeOut)
- Card hover: whileHover={{ y: -6 }} with duration 0.3 (matching established patterns)
- Hover overlay and narrative: opacity transition (CSS transition-opacity duration-300)

**Imports needed:**
- `motion` from "framer-motion"
- `Link` from "next/link"
- `useRef, useState, useEffect` from "react"
- `cn` from "@/lib/utils"
- `type TemplateData, categoryLabels` from "@/lib/templateData"

Export as named export: `export function PortfolioCard({ ... })`.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors.
Run `npm run build` — builds without errors.
Verify PortfolioCard is exported from TemplateCard.tsx.
Verify existing TemplateShowcaseCard and TemplateGridCard exports still exist.
  </verify>
  <done>
PortfolioCard component exists with video hover crossfade, touch detection, IntersectionObserver lazy loading, narrative tagline overlay, category tag chips, and custom cursor integration. Existing card components preserved. TypeScript compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Assemble masonry grid with sticky filter bar in portfolio page</name>
  <files>src/app/portfolio/page.tsx</files>
  <action>
Replace the existing 2-column grid and filter implementation in portfolio/page.tsx with the masonry grid, sticky filter bar, and new PortfolioCard.

**Import changes:**
- Replace `TemplateShowcaseCard` import with `PortfolioCard` from "@/components/ui/TemplateCard"
- Remove unused imports: `Eye`, `ExternalLink`, `Star`, `Sparkles`, `Crown`, `Zap`, `Check` (these were used by the old card)
- Keep: `useState`, `useRef`, `motion`, `useInView`, `AnimatePresence`, `Link`, `ArrowRight`
- Keep icon imports for filter bar: `LayoutGrid`, `Briefcase`, `Wrench`, `Heart`, `Palette`, `ShoppingBag`
- Keep: `Header`, `Footer`, `Container`, `Section`, `Button`
- Keep: `templates`, `categoryGroups`, `categoryLabels`

**Sticky filter bar (replaces existing filter):**
- Position: Inside the light (middle) section, before the grid
- Sticky behavior: `sticky top-0 z-20 bg-white/95 backdrop-blur-md py-4 -mx-4 px-4 sm:-mx-6 sm:px-6 lg:-mx-8 lg:px-8` (breaks out of Container padding for full-width sticky, matches Container responsive padding)
- Keep the existing 6 category group pill buttons (All, Business, Services, Lifestyle, Creative, Shopping)
- Active state: `bg-primary text-white shadow-lg shadow-primary/25`
- Inactive state: `bg-muted text-muted-foreground hover:bg-primary/10 hover:text-primary`
- All filter buttons: add `data-cursor="button"` for custom cursor
- Remove the secondary sub-category filter pills entirely — keep only the 6 primary group filters for simplicity
- Keep count badges on pills: `<span className="text-xs opacity-50">{count}</span>`

**Masonry grid:**
- Grid container: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-auto`
- Popular templates (template.popular === true) get `md:col-span-2` to span 2 columns — creates mixed-size visual hierarchy
- Sorting strategy: Sort templates to space popular ones apart (don't cluster all large cards together). Strategy:
  - Interleave popular and non-popular templates. For every 3-4 non-popular, insert 1 popular.
  - This creates visual rhythm: small, small, LARGE, small, small, small, LARGE pattern
- Each card wrapper: `<motion.div key={template.id} variants={itemVariants} className={cn("group", template.popular && "md:col-span-2")}>`
- Render `<PortfolioCard template={template} featured={template.popular} />` inside each wrapper

**Filtering logic:**
- Keep existing filtering logic (activeGroup state, handleGroupClick)
- Remove activeCategory state and sub-category filtering (sub-category filter removed above)
- When a group is selected, filter templates to those in the group's categories
- "All" shows all templates
- Wrap grid in AnimatePresence for filter transitions

**Empty state:**
- Keep existing empty state with "No templates found" message and "View All" button

**Container animation:**
- Use containerVariants with staggerChildren: 0.08 (slightly faster than current 0.12 for 21 cards)
- itemVariants: opacity 0->1, y 20->0, duration 0.5, easeOut

**Section spacing:**
- The light middle section: use custom className for varied padding: `py-20 md:py-28` (not the standard py-16 md:py-24)
- Add `pt-6` after the sticky filter bar before the grid (breathing room)
  </action>
  <verify>
Run `npm run build` — page builds without errors.
Open http://localhost:3000/portfolio — verify:
1. Sticky filter bar stays at top when scrolling
2. Masonry grid shows 3 columns on desktop with popular templates spanning 2 columns
3. Filter pills correctly filter templates
4. Cards show PortfolioCard design (screenshot, name, category chip, price)
5. Hover on desktop shows video crossfade (for popular templates) or zoom (for others)
6. Custom cursor coral spotlight appears on card hover
  </verify>
  <done>
Portfolio page uses masonry grid with 3/2/1 responsive columns. Popular templates span 2 columns. Sticky filter bar with 6 category pills. PortfolioCard component renders in grid with video hover and custom cursor. Filtering works correctly. Build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of portfolio page redesign</name>
  <files></files>
  <action>
Present the complete portfolio page redesign for human visual verification. Start dev server if not already running (`npm run dev`).

What was built across Phase 06 Plans 01 and 02:

**Page Structure (Dark -> Light -> Dark):**
- Dark navy hero: "Our Work Speaks. Loudly." with bold display typography
- Light masonry grid section with sticky category filter bar (6 pills)
- Dark CTA section: "Don't See What You Need? Let's Build It."

**Masonry Grid:**
- 3 columns desktop, 2 tablet, 1 mobile
- Popular templates span 2 columns (mixed-size visual hierarchy)
- Simplified card design: screenshot, category chip, name, price badge

**Video Hover:**
- Popular templates (4) show muted autoplay video crossfade on hover
- Other templates show subtle zoom on screenshot
- Narrative taglines appear in hover overlay
- Custom cursor coral spotlight on card hover

**Verification steps for human:**
1. Navigate to http://localhost:3000/portfolio
2. Verify dark navy hero at top with "Our Work Speaks. Loudly." headline
3. Scroll down — verify filter bar sticks to top of viewport
4. Verify masonry grid: 3 columns on desktop, popular templates are wider (span 2 cols)
5. Hover over a popular template card — verify video crossfade plays muted
6. Mouse leave — verify video pauses and overlay disappears
7. Hover over a non-popular card — verify subtle zoom on screenshot
8. Verify narrative tagline appears in hover overlay
9. Click filter pills — verify templates filter correctly
10. Scroll to bottom — verify dark CTA section with "Don't See What You Need?" headline
11. Resize to tablet width (~768px) — verify 2 columns, cards stack properly
12. Resize to mobile width (~375px) — verify single column, no video on hover
13. Verify custom cursor: coral spotlight appears on card hover, button cursor on CTAs
  </action>
  <verify>Human confirms visual quality by typing "approved" or describes issues to fix.</verify>
  <done>Portfolio page redesign approved by human. All Phase 6 success criteria met: masonry layout, video hover, narrative copy, mobile responsive, Dark -> Light -> Dark rhythm.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes — no build errors
2. Portfolio page loads at /portfolio
3. Masonry grid: 3 columns desktop, 2 tablet, 1 mobile
4. Popular templates span 2 columns on desktop (md:col-span-2)
5. Video crossfade on hover for templates with videoUrl (4 popular templates)
6. Zoom on hover for templates without video
7. Video pauses and resets on mouse leave
8. No video on touch devices
9. Sticky filter bar with 6 category pills
10. Simplified card: screenshot, name, category chip, price badge (no breakdown panel)
11. Narrative tagline in hover overlay
12. Dark -> Light -> Dark section rhythm
13. Custom cursor data-cursor="card" on all cards
14. Human visual verification approved
</verification>

<success_criteria>
Portfolio page is a visually dynamic masonry layout with video-on-hover cards, narrative copy, sticky filtering, and bold Dark -> Light -> Dark section rhythm. Popular templates stand out with 2-column spans. Cards are simplified and bold. All existing functionality (filtering, links to templates, pricing info) preserved. Human approves visual quality.
</success_criteria>

<output>
After completion, create `.planning/phases/06-portfolio-page-redesign/06-02-SUMMARY.md`
</output>
