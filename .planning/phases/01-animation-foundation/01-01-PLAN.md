---
phase: 01-animation-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/gsap.ts
  - src/lib/providers/SmoothScrollProvider.tsx
  - src/app/layout.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "GSAP 3.14+, @gsap/react, and Lenis 1.3+ are installed as project dependencies"
    - "All GSAP plugins are registered in a single centralized file (lib/gsap.ts)"
    - "Smooth scroll feels noticeably fluid on all pages — not barely-there, clearly custom"
    - "Keyboard scrolling (arrow keys, Page Up/Down, Space) goes through Lenis"
    - "Pages scroll to top instantly on route changes (no leftover momentum)"
    - "Existing Framer Motion animations and ThemeProvider continue working unchanged"
    - "Native scrollbar is hidden — scroll is functional but scrollbar is invisible"
  artifacts:
    - path: "src/lib/gsap.ts"
      provides: "Centralized GSAP plugin registration and default configuration"
      exports: ["gsap", "ScrollTrigger"]
    - path: "src/lib/providers/SmoothScrollProvider.tsx"
      provides: "Lenis smooth scroll wrapper with GSAP ticker sync and route change handling"
      exports: ["SmoothScrollProvider"]
  key_links:
    - from: "src/lib/providers/SmoothScrollProvider.tsx"
      to: "src/lib/gsap.ts"
      via: "import { gsap, ScrollTrigger } from '@/lib/gsap'"
      pattern: "import.*from.*@/lib/gsap"
    - from: "src/app/layout.tsx"
      to: "src/lib/providers/SmoothScrollProvider.tsx"
      via: "SmoothScrollProvider wraps children in root layout body"
      pattern: "SmoothScrollProvider"
    - from: "src/lib/providers/SmoothScrollProvider.tsx"
      to: "lenis/react"
      via: "ReactLenis component with GSAP ticker driving RAF"
      pattern: "ReactLenis.*autoRaf.*false"
---

<objective>
Install GSAP + Lenis and wire them into the Next.js app as the animation infrastructure layer.

Purpose: Establish the smooth scroll foundation and centralized GSAP configuration that all future phases (cursor, homepage redesign, scroll animations) build on. This is pure plumbing — no visible design changes yet, but the scroll feel should be immediately noticeable.

Output: Working smooth scroll across all pages, centralized GSAP config file, SmoothScrollProvider at app root.
</objective>

<execution_context>
@C:/Users/sammy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sammy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-animation-foundation/01-RESEARCH.md
@src/app/layout.tsx
@src/app/globals.css
@src/lib/animations.ts
@src/components/ui/ThemeProvider.tsx
@src/components/ui/ScrollToTop.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install GSAP ecosystem and create centralized config</name>
  <files>package.json, src/lib/gsap.ts</files>
  <action>
1. Install packages:
   ```bash
   npm install gsap@latest @gsap/react lenis@latest
   ```
   Verify gsap is 3.14+, @gsap/react is 2.1+, lenis is 1.3+.

2. Create `src/lib/gsap.ts` — centralized plugin registration file:
   - Import gsap from 'gsap'
   - Import ScrollTrigger from 'gsap/ScrollTrigger'
   - Register ScrollTrigger via `gsap.registerPlugin(ScrollTrigger)`
   - Set GSAP global defaults: `ease: 'power2.out'`, `duration: 0.6`
   - Set ScrollTrigger defaults: `toggleActions: 'play none none none'`
   - Enable dev markers ONLY in development: `markers: process.env.NODE_ENV === 'development'` (set to false — dev can enable manually; markers clutter the viewport)
   - Export `{ gsap, ScrollTrigger }` as named exports
   - Add comment: "Import gsap and ScrollTrigger from this file, NOT from 'gsap' directly"

IMPORTANT: Do NOT register plugins in individual components. This file is the single source of truth. All future components must import from `@/lib/gsap`.
  </action>
  <verify>
- `npm ls gsap @gsap/react lenis` shows all three installed with correct versions
- `src/lib/gsap.ts` exists and exports gsap and ScrollTrigger
- No TypeScript errors: `npx tsc --noEmit` passes (or at minimum, no errors in gsap.ts)
  </verify>
  <done>GSAP 3.14+, @gsap/react 2.1+, and Lenis 1.3+ installed. Centralized `lib/gsap.ts` registers ScrollTrigger and sets sensible defaults. All future GSAP usage imports from this file.</done>
</task>

<task type="auto">
  <name>Task 2: Create SmoothScrollProvider and wire into root layout</name>
  <files>src/lib/providers/SmoothScrollProvider.tsx, src/app/layout.tsx, src/app/globals.css</files>
  <action>
1. Create `src/lib/providers/SmoothScrollProvider.tsx` as a "use client" component:

   **Lenis configuration (per user decision — fluid, design-forward, kota + strangepixels feel):**
   ```
   lerp: 0.075          — Noticeably smooth but not sluggish (0.05 is too slow for most users, 0.1 is barely noticeable)
   smoothWheel: true     — Enable smooth mouse wheel
   smoothTouch: true     — Mobile gets smooth scroll too (per user decision: all devices)
   touchMultiplier: 1.5  — Slightly slower touch scroll for fluid feel
   wheelMultiplier: 1    — Standard wheel speed
   infinite: false
   orientation: 'vertical'
   gestureOrientation: 'vertical'
   syncTouch: true       — Sync touch scrolling (test on mobile — fall back to false if perf issues)
   ```

   **GSAP ticker sync:**
   - Use `useEffect` to add a callback to `gsap.ticker` that calls `lenisRef.current?.lenis?.raf(time * 1000)`
   - Set `gsap.ticker.lagSmoothing(0)` to disable lag smoothing (required for smooth scroll fidelity)
   - Clean up on unmount: `gsap.ticker.remove(update)`
   - Set `autoRaf={false}` on ReactLenis — we control the animation frame via GSAP ticker

   **Route change scroll-to-top:**
   - Import `usePathname` from 'next/navigation'
   - In a `useEffect` keyed on pathname, call `lenisRef.current?.lenis?.scrollTo(0, { immediate: true })` — instant, not smooth, to avoid "scrolling while loading" per research recommendation
   - Also call `ScrollTrigger.refresh()` after a short delay (100ms) to recalculate positions after route content loads

   **Ref management:**
   - Use `useRef` for the ReactLenis component ref to access the lenis instance

2. Update `src/app/layout.tsx`:
   - Import SmoothScrollProvider from `@/lib/providers/SmoothScrollProvider`
   - Wrap `{children}` with `<SmoothScrollProvider>` INSIDE ThemeProvider (ThemeProvider must stay outermost since it manages document class)
   - Provider order: `ThemeProvider > SmoothScrollProvider > {children}`
   - Keep ScrollToTop and ChatWidget inside SmoothScrollProvider (they need to be within the scroll context)

3. Update `src/app/globals.css`:
   - REMOVE the existing `html { scroll-behavior: smooth; }` rule — Lenis replaces this. Having both causes conflicts.
   - REMOVE the existing custom scrollbar styles (`::-webkit-scrollbar` etc.) — we're hiding the scrollbar entirely per both inspiration sites.
   - ADD Lenis-required CSS classes:
     ```css
     /* Lenis smooth scroll */
     html.lenis,
     html.lenis body {
       height: auto;
     }

     .lenis.lenis-smooth {
       scroll-behavior: auto !important;
     }

     .lenis.lenis-smooth [data-lenis-prevent] {
       overscroll-behavior: contain;
     }

     .lenis.lenis-stopped {
       overflow: hidden;
     }

     /* Hide scrollbar — both inspiration sites hide theirs */
     html.lenis.lenis-smooth::-webkit-scrollbar {
       display: none;
     }

     html.lenis.lenis-smooth {
       -ms-overflow-style: none;
       scrollbar-width: none;
     }
     ```
   - Place Lenis CSS after the base body styles and before the selection/focus styles.

IMPORTANT: Do NOT modify ThemeProvider, ScrollToTop, ChatWidget, or any existing Framer Motion animations. This phase is additive — existing functionality must remain intact.

NOTE on ScrollToTop: It uses `window.scrollTo` which Lenis intercepts by default. It should continue working. If it doesn't, the fix would be to use `lenis.scrollTo(0)` instead — but do NOT change it in this phase. Verify it works during testing.
  </action>
  <verify>
- `npm run build` succeeds with no errors
- `npm run dev` starts and smooth scroll is visibly working (page scrolls with fluid momentum)
- Route changes (click navigation links) scroll to top instantly
- Keyboard scrolling (arrow keys, Space, Page Down) scrolls smoothly through Lenis
- Existing Framer Motion animations (ScrollToTop button fade, mobile menu) still work
- ThemeProvider dark/light toggle still works
- No console errors related to GSAP, Lenis, or hydration
- ChatWidget remains functional
- Scrollbar is hidden (not visible in browser)
  </verify>
  <done>SmoothScrollProvider wraps the app at root level. Smooth scroll is active on all pages and all devices. Keyboard navigation goes through Lenis. Route changes scroll to top instantly. Scrollbar is hidden. All existing functionality (theme, ScrollToTop, ChatWidget, Framer Motion) works unchanged.</done>
</task>

</tasks>

<verification>
1. `npm run build` — builds successfully with zero errors
2. `npm run dev` — starts dev server, navigate to homepage
3. Scroll with mouse wheel — scroll should feel noticeably smoother than native, with momentum
4. Scroll with keyboard (arrow keys, Space, Page Down) — should scroll smoothly, not native jump
5. Click a navigation link to change routes — page should scroll to top instantly
6. Press browser back button — page loads at expected position
7. Open browser DevTools console — no GSAP, Lenis, or hydration errors
8. Toggle dark/light theme — ThemeProvider still works
9. Scroll down to see ScrollToTop button — still appears and works
10. Check scrollbar — should be hidden (not visible on page)
</verification>

<success_criteria>
- GSAP 3.14+, @gsap/react, and Lenis 1.3+ installed and verified
- lib/gsap.ts centralizes all GSAP plugin registration and defaults
- SmoothScrollProvider at app root with GSAP ticker sync
- Smooth scroll active on all pages (desktop + mobile)
- Keyboard scrolling goes through Lenis
- Route changes scroll to top instantly
- Scrollbar hidden
- Zero build errors, zero console errors
- All existing functionality intact (ThemeProvider, ScrollToTop, ChatWidget, Framer Motion)
</success_criteria>

<output>
After completion, create `.planning/phases/01-animation-foundation/01-01-SUMMARY.md`
</output>
